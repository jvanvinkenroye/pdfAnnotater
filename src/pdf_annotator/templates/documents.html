{% extends "base.html" %}

{% block title %}Dokumente - PDF Annotator{% endblock %}

{% block nav %}
<a href="{{ url_for('upload.index') }}" class="btn btn-primary btn-sm">
    Neues PDF hochladen
</a>
{% endblock %}

{% block content %}
<div class="documents-container">
    <div class="documents-header">
        <div>
            <h1>Ihre PDF-Dokumente</h1>
            <p class="subtitle">Wählen Sie ein Dokument aus, um es zu bearbeiten oder fortzufahren.</p>
        </div>
        <div class="data-actions">
            <button class="btn btn-secondary" id="btn-export-data" title="Alle Daten als ZIP exportieren">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Exportieren
            </button>
            <button class="btn btn-secondary" id="btn-import-data" title="Daten aus ZIP importieren">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="17 8 12 3 7 8"></polyline>
                    <line x1="12" y1="3" x2="12" y2="15"></line>
                </svg>
                Importieren
            </button>
            <input type="file" id="import-file-input" accept=".zip" style="display: none;">
        </div>
    </div>

    {% if documents %}
    <div class="table-container">
        <table class="documents-table" id="documents-table">
            <thead>
                <tr>
                    <th class="sortable" data-column="0">Dateiname <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="1">Vorname <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="2">Nachname <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="3">Titel <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="4">Jahr <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="5">Thema <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="6">Seiten <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="7">Hochgeladen <span class="sort-icon">⇅</span></th>
                    <th class="sortable" data-column="8">Zuletzt bearbeitet <span class="sort-icon">⇅</span></th>
                    <th>Aktionen</th>
                </tr>
            </thead>
            <tbody>
                {% for doc in documents %}
                <tr>
                    <td class="filename-cell" data-label="Dateiname">{{ doc.original_filename | e }}</td>
                    <td data-label="Vorname">{{ doc.first_name | e if doc.first_name else '-' }}</td>
                    <td data-label="Nachname">{{ doc.last_name | e if doc.last_name else '-' }}</td>
                    <td data-label="Titel">{{ doc.title | e if doc.title else '-' }}</td>
                    <td data-label="Jahr">{{ doc.year | e if doc.year else '-' }}</td>
                    <td data-label="Thema">{{ doc.subject | e if doc.subject else '-' }}</td>
                    <td class="center" data-label="Seiten">{{ doc.page_count }}</td>
                    <td data-label="Hochgeladen">{{ doc.upload_timestamp.strftime('%Y-%m-%d %H:%M') if doc.upload_timestamp else '-' }}</td>
                    <td data-label="Bearbeitet">{{ doc.last_edited[:16] if doc.last_edited else '-' }}</td>
                    <td class="actions-cell" data-label="Aktionen">
                        <a href="{{ url_for('viewer.view_document', doc_id=doc.id) }}" class="btn btn-primary btn-sm" title="Dokument bearbeiten">
                            Öffnen
                        </a>
                        <button class="btn btn-secondary btn-sm btn-download btn-replace" title="PDF ersetzen" data-doc-id="{{ doc.id }}">
                            Ersetzen
                        </button>
                        <a href="{{ url_for('export.download_original_pdf', doc_id=doc.id) }}" class="btn btn-secondary btn-sm btn-download" title="Original-PDF herunterladen">
                            PDF
                        </a>
                        <a href="{{ url_for('export.export_pdf', doc_id=doc.id) }}" class="btn btn-secondary btn-sm btn-download btn-export-pdf" title="Annotiertes PDF herunterladen" data-doc-id="{{ doc.id }}">
                            Annotiert
                        </a>
                        <a href="{{ url_for('export.export_markdown', doc_id=doc.id) }}" class="btn btn-secondary btn-sm btn-download btn-export-md" title="Markdown-Notizen herunterladen" data-doc-id="{{ doc.id }}">
                            MD
                        </a>
                        <button class="btn btn-danger btn-sm btn-delete" title="Dokument löschen" data-doc-id="{{ doc.id }}" data-filename="{{ doc.original_filename | e }}">
                            Löschen
                        </button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
        </svg>
        <h2>Noch keine Dokumente</h2>
        <p>Laden Sie Ihr erstes PDF hoch, um zu beginnen.</p>
        <a href="{{ url_for('upload.index') }}" class="btn btn-primary">
            Jetzt PDF hochladen
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<!-- Hidden file input for PDF replacement -->
<input type="file" id="replace-pdf-file-input" accept=".pdf" style="display: none;">
<script src="{{ url_for('static', filename='js/documents.js') }}"></script>
{% endblock %}
